<form action="<%= card_sets_path %>" method="get" class="mb-5">
  <div class="field is-grouped is-grouped-multiline ml-3">

    <div class="control">
      <input class="input" type="text" name="name" placeholder="Search by name" value="<%= params[:name] %>">
    </div>

    <div class="control">
      <div class="select">
        <select name="series">
          <option value="">All Series</option>
          <% CardSet.distinct.pluck(:series).each do |series| %>
            <option value="<%= series %>" <%= 'selected' if params[:series] == series %>>
              <%= series %>
            </option>
          <% end %>
        </select>
      </div>
    </div>

    <div class="control">
      <div class="select">
        <select name="sort">
          <option value="name_asc" <%= 'selected' if params[:sort] == 'name_asc' %>>A → Z</option>
          <option value="name_desc" <%= 'selected' if params[:sort] == 'name_desc' %>>Z → A</option>
        </select>
      </div>
    </div>
    
    <div class="control">
      <div class="select">
        <select name="release_order">
          <option value="newest" <%= 'selected' if params[:release_order] == 'newest' %>>Newest → Oldest</option>
          <option value="oldest" <%= 'selected' if params[:release_order] == 'oldest' %>>Oldest → Newest</option>
        </select>
      </div>
    </div>

    <div class="control">
      <button type="submit" class="button is-primary">Filter</button>
    </div>

  </div>
</form>

<div class="columns is-multiline mx-2">
  <% @card_sets.each do |set| %>
    <div class="column is-one-quarter">
      <%= link_to card_set_path(set) do %>
        <div class="card">
          <div class="card-image">
            <figure class="image is-4by3" style="display: flex; align-items: center; justify-content: center; overflow: hidden;">
              <%= image_tag set.logo.image_url, alt: set.name, style: "object-fit: contain; max-width: 100%; max-height: 100%;" if set.logo %>
            </figure>
          </div>
          <div class="card-content has-text-centered">
            <p class="title is-6"><%= set.name %></p>
            <p class="subtitle is-7"><%= set.series %></p>
          </div>
        </div>
      <% end %>
    </div>
  <% end %>
</div>

<nav class="pagination is-centered" role="navigation" aria-label="pagination">
  <% if @card_sets.prev_page %>
    <%= link_to "&laquo; Previous".html_safe, card_sets_path(page: @card_sets.prev_page), class: "pagination-previous" %>
  <% else %>
    <a class="pagination-previous" disabled>&laquo; Previous</a>
  <% end %>

  <% if @card_sets.next_page %>
    <%= link_to "Next &raquo;".html_safe, card_sets_path(page: @card_sets.next_page), class: "pagination-next" %>
  <% else %>
    <a class="pagination-next" disabled>Next &raquo;</a>
  <% end %>

  <ul class="pagination-list">
    <% (1..@card_sets.total_pages).each do |page_number| %>
      <li>
        <% if page_number == @card_sets.current_page %>
          <a class="pagination-link is-current"><%= page_number %></a>
        <% else %>
          <%= link_to page_number, card_sets_path(page: page_number), class: "pagination-link" %>
        <% end %>
      </li>
    <% end %>
  </ul>
</nav>
